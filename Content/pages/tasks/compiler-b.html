<!DOCTYPE html>
<head><title>The OCaml Compiler</title>
    <style>
    a.icon-github {
	background: url(../github.png) no-repeat 0 0;
	padding: 0 0 2px 2em;
    }
    a.icon-cloud {
	background: url(../cloud.png) no-repeat 0 0;
        background-size: 17px;
	padding: 0 0 2px 2em;
    }
    a.icon-bullhorn {
	background: url(../bullhorn.png) no-repeat 0 0;
        background-size: 17px;
	padding: 0 0 2px 2em;
    }
    a.icon-wrench {
	background: url(../wrench.png) no-repeat 0 0;
        background-size: 17px;
	padding: 0 0 2px 2em;
    }
    </style>
  </head><body>
    <div class="ucampas-toc right"></div>
    
    
            <style type="text/css">
            table { 
            table-layout: fixed;
            border-spacing: 0px 2px;
            }
            .blank { background-color: #fefefe; }
            .planning { font-size: 80%; background-color: #bbccee; }
            .doing { font-size: 80%; background-color: #eeeebb; }
            .complete { font-size: 80%; background-color: #bbddbb; }
            img.mugshot { float:left; padding-right: 5px; }
            tr.dates {
            font-size: 0.75em;
            background-color: #dfdfdf;
            color: #111111;
            }
            </style>
          
    <h1 id="compiler">The OCaml Compiler</h1>
    <div class="width:75%"><p><a href="http://ocaml.org"><img width="70px" src="../images/ocaml-grey.png" class="left"/></a>We are working on maintaining and extending the core OCaml compiler toolchain
and runtime. This consists of a variety of day-to-day tasks such as submitting
bug fixes, and also longer-term improvements to the type system and runtime
libraries (see below).</p>
<p>We are actively engaging with the wider OCaml community to ensure that any 
improvements and modifications we propose are thoroughly discussed, 
well-formulated and maintainable.</p>
</div>
    <h2 id="Team">Team</h2>
    <p><a href="http://anil.recoil.org"><img class="inline" style="" height="50px" src="../mugshots/avsm.jpg"/></a><a href="http://kcsrk.info"><img class="inline" style="" height="50px" src="../mugshots/kc.jpg"/></a><a href="http://lpw25.net"><img class="inline" style="" height="50px" src="../mugshots/lpw25.jpg"/></a><a href="http://www.three-tuns.net/mark"><img class="inline" style="" height="50px" src="../mugshots/shinwell.jpg"/></a><a href="https://github.com/stedolan"><img class="inline" style="" height="50px" src="../mugshots/stedolan.jpg"/></a><a href="http://www.x9c.fr"><img class="inline" style="" height="50px" src="../mugshots/xavierclerc.jpg"/></a><img class="inline" style="" height="50px" src="../mugshots/yallop.jpeg"/></p>
    <h2 id="Tasks">Tasks</h2>
    <table class="projects" width="95%">
    <tr class="dates"><td> </td><td> </td><td> </td><td> </td><td>2013</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td>2014</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td>2015</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td>∞</td></tr>
     <tr> <td class="blank" colspan="7"></td> <td class="doing" colspan="25">
               <a href="http://kcsrk.info"><img class="mugshot" alt="KC Sivaramakrishnan" src="../mugshots/kc.jpg" height="30px"/></a>
               <a href="#Multicore">Multicore</a><br/>
             </td> <td class="blank" colspan="7"></td> <td></td> </tr>  <tr> <td class="blank" colspan="5"></td> <td class="doing" colspan="27">
               <a href="http://www.three-tuns.net/mark"><img class="mugshot" alt="Mark Shinwell" src="../mugshots/shinwell.jpg" height="30px"/></a>
               <a href="#Emission of DWARF debugging information">Emission of DWARF debugging information</a><br/>
             </td> <td class="blank" colspan="7"></td> <td></td> </tr>  <tr> <td class="blank" colspan="17"></td> <td class="complete" colspan="13">
               <a href="http://lpw25.net"><img class="mugshot" alt="Leo White" src="../mugshots/lpw25.jpg" height="30px"/></a>
               <a href="#Modular Implicits prototype">Modular Implicits prototype</a><br/>
             </td> <td class="blank" colspan="9"></td> <td></td> </tr>  <tr> <td class="blank" colspan="6"></td> <td class="complete" colspan="19">
               <a href="http://lpw25.net"><img class="mugshot" alt="Leo White" src="../mugshots/lpw25.jpg" height="30px"/></a>
               <a href="#Namespaces and module aliases">Namespaces and module aliases</a><br/>
             </td> <td class="blank" colspan="14"></td> <td></td> </tr>  <tr> <td class="blank" colspan="10"></td> <td class="complete" colspan="14">
               <img class="mugshot" alt="Jeremy Yallop" src="../mugshots/yallop.jpeg" height="30px"/>
               <a href="#Higher kinded polymorphism">Higher kinded polymorphism</a><br/>
             </td> <td class="blank" colspan="15"></td> <td></td> </tr>  <tr> <td class="blank" colspan="15"></td> <td class="complete" colspan="7">
               <img class="mugshot" alt="Jeremy Yallop" src="../mugshots/yallop.jpeg" height="30px"/>
               <a href="#Exception matches">Exception matches</a><br/>
             </td> <td class="blank" colspan="17"></td> <td></td> </tr>  <tr> <td class="blank" colspan="2"></td> <td class="complete" colspan="19">
               <a href="http://lpw25.net"><img class="mugshot" alt="Leo White" src="../mugshots/lpw25.jpg" height="30px"/></a>
               <a href="#Open types">Open types</a><br/>
             </td> <td class="blank" colspan="18"></td> <td></td> </tr>  <tr> <td class="blank" colspan="8"></td> <td class="complete" colspan="4">
               <a href="http://www.x9c.fr"><img class="mugshot" alt="Xavier Clerc" src="../mugshots/xavierclerc.jpg" height="30px"/></a>
               <a href="#OCaml Java">OCaml Java</a><br/>
             </td> <td class="blank" colspan="27"></td> <td></td> </tr>  <tr> <td class="blank" colspan="4"></td> <td class="complete" colspan="6">
               <a href="http://lpw25.net"><img class="mugshot" alt="Leo White" src="../mugshots/lpw25.jpg" height="30px"/></a>
               <a href="#Syntax extensions">Syntax extensions</a><br/>
             </td> <td class="blank" colspan="29"></td> <td></td> </tr>  <tr> <td class="blank" colspan="1"></td> <td class="complete" colspan="5">
               <a href="http://lpw25.net"><img class="mugshot" alt="Leo White" src="../mugshots/lpw25.jpg" height="30px"/></a>
               <a href="#Record disambiguation">Record disambiguation</a><br/>
             </td> <td class="blank" colspan="33"></td> <td></td> </tr> 
    <tr><td colspan="40"> </td></tr>
    </table>
  
    
         <div style="width:75%">
         <h3 style="border-bottom: thin solid #999999;" id="Multicore">Multicore</h3>
         <p><a href="http://kcsrk.info"><img class="inline" style="float:left; padding-right: 30px" height="40px" src="../mugshots/kc.jpg"/></a>  <span class="doing">In Progress</span> by <a href="../people/kchandras.html">KC Sivaramakrishnan</a> (Mar 2013 - Apr 2015) <br/><a class="icon-github" href="https://github.com/stedolan/ocaml">Github</a>   <a class="icon-pdf" href="../papers/index.html#multicore-ocaml-2014">Paper</a>   <a class="icon-bullhorn" href="https://www.youtube.com/watch?v=FzmQTC_X5R4">Video</a>   </p>
         <p>Adding shared-memory parallelism to an existing language
presents an interesting set of challenges. As
well as the difficulties of memory management in a
parallel setting, we must maintain as much backwards
compatibility as practicable. This includes not just
compatibility of the language semantics, but also of
the performance profile, memory usage and C bindings.
In the case of OCaml, users have come to rely
on certain operations being cheap, and OCaml’s C
API exposes quite a lot of internals.</p>
<p>The biggest challenge is implementing the garbage
collector. GC in OCaml is interesting because of pervasive
immutability. Many objects are immutable,
which simplifies some aspects of a parallel GC but
requires the GC to sustain a very high allocation rate.
Operations on immutable objects are very fast in
OCaml: allocation is by bumping a pointer, initialising
writes (the only ones) are done with no barriers,
and reads require no barriers. Our design is focussed
on keeping these operations as fast as they are at the
moment, with some compromises for mutable objects.</p>
<p>A previous design by Doligez et al. for Caml
Light was based on many thread-private heaps and
a single shared heap. It maintains the invariant that
there are no pointers from the shared to the private
heaps. Thus, storing a pointer to a private object
into the shared heap causes the private object and
all objects reachable from it to be promoted to the
shared heap en masse. Unfortunately this eagerly
promotes many objects that were never really shared:
just because an object is pointed to by a shared object
does not mean another thread is actually going to
attempt to access it.</p>
<p>Our design is similar but lazier, along the lines of
the multicore Haskell work, where objects are promoted
to the shared heap whenever another thread
actually tries to access them. This has a slower sharing
operation, since it requires synchronisation of two
different threads, but it is performed less often.</p>
<p>Please see the OCaml 2014 short paper linked above
for more details.</p>

         <br/></div>
      
         <div style="width:75%">
         <h3 style="border-bottom: thin solid #999999;" id="Emission of DWARF debugging information">Emission of DWARF debugging information</h3>
         <p><a href="http://www.three-tuns.net/mark"><img class="inline" style="float:left; padding-right: 30px" height="40px" src="../mugshots/shinwell.jpg"/></a>  <span class="doing">In Progress</span> by <a href="../people/shinwell.html">Mark Shinwell</a> (Jan 2013 - Apr 2015) <br/><a class="icon-github" href="https://github.com/mshinwell/ocaml">4.00.1-allocation-profiling</a>   <a class="icon-bullhorn" href="https://www.youtube.com/watch?v=NF2WpWnB-nk">Video</a>   </p>
         <p>Debuggers such as the GNU debugger <a href="http://www.gnu.org/software/gdb/">gdb</a> are
valuable tools when tracking down problems in low-level or parallel
applications.  The programmer experience when using such a debugger to examine
natively-compiled OCaml programs currently lacks lustre.  Recent versions of
the compiler can emit a limited amount of debugging information which enables
the recovery of correct stack traces in the debugger.  However names of
functions still appear in mangled form, it is not possible to reference local
variables by name, and traversal of OCaml values is troublesome.  This is
unfortunately by no means an exhaustive list of deficiencies.</p>
<p>This project aims to equip the native-code OCaml compiler and the GNU debugger
with the necessary infrastructure to improve debugging of OCaml programs.  The
compiler will be enhanced to emit the standard DWARF debugging information
format in order to describe the naming and placement of data together with
relevant type information.  At the same time the debugger will gain
functionality to understand the OCaml-specific parts of this information
including the ability to demangle OCaml names.  It is planned to implement much
of the DWARF output stage in the compiler and the debugger-side support in
libraries such that they might be re-used in other projects.</p>
<p>It is hoped that, as support for native-code debugging of OCaml programs in the
traditional manner evolves, it will become more easily possible to build more
advanced debugging tools.  These might exploit the scripting capabilities of
gdb, for example, and target environments such as large-scale concurrent
systems.</p>
<p>This work is ongoing in the <a href="https://github.com/ocaml/ocaml/tree/dwarf">dwarf</a>
branch of the OCaml repository.</p>

         <br/></div>
      
         <div style="width:75%">
         <h3 style="border-bottom: thin solid #999999;" id="Modular Implicits prototype">Modular Implicits prototype</h3>
         <p><a href="http://lpw25.net"><img class="inline" style="float:left; padding-right: 30px" height="40px" src="../mugshots/lpw25.jpg"/></a>  <span class="complete">Complete</span> by <a href="../people/lpw25.html">Leo White</a> (Jan 2014 - Feb 2015) <br/><a class="icon-github" href="https://github.com/ocamllabs/ocaml-modular-implicits">Github</a>   <a class="icon-cloud" href="http://andrewray.github.io/iocamljs/modimp_show.html">Demo</a>   <a class="icon-pdf" href="../papers/index.html#modular-implicits-2014">Paper</a>   <a class="icon-bullhorn" href="https://www.youtube.com/watch?v=3wVUXTd4WNc">Video</a>   </p>
         <p>A common criticism of OCaml is its lack of support for ad-hoc polymorphism. The
classic example of this is OCaml’s separate addition operators for integers
<code>(+)</code> and floating-point numbers <code>(+.)</code>.  Another example is the need for
type-specific printing functions (<code>print_int</code>, <code>print_string</code>, etc.) rather
than a single print function which works across multiple types.</p>
<p>Taking inspiration from Scala’s
<a href="http://docs.scala-lang.org/tutorials/tour/implicit-parameters.html">implicits</a>
and &quot;<a href="http://www.mpi-sws.org/~dreyer/papers/mtc/main-long.pdf">Modular Type
Classes</a>&quot;, we propose
a system for ad-hoc polymorphism in OCaml based on using modules as
type-directed implicit parameters.  You can try out an <a href="http://andrewray.github.io/iocamljs/modimp_show.html">interactive REPL</a>
of a prototype implementation online.</p>

         <br/></div>
      
         <div style="width:75%">
         <h3 style="border-bottom: thin solid #999999;" id="Namespaces and module aliases">Namespaces and module aliases</h3>
         <p><a href="http://lpw25.net"><img class="inline" style="float:left; padding-right: 30px" height="40px" src="../mugshots/lpw25.jpg"/></a>  <span class="complete">Complete</span> by <a href="../people/lpw25.html">Leo White</a> (Feb 2013 - Sep 2014) <br/><a class="icon-cloud" href="http://www.lpw25.net/2013/03/10/ocaml-namespaces.html">Blog</a>   <a class="icon-cloud" href="http://lists.ocaml.org/pipermail/platform/2013-February/000050.html">Epic Mail Thread</a>   <a class="icon-pdf" href="../papers/index.html#module-aliases-2014">Paper</a>   <a class="icon-bullhorn" href="https://www.youtube.com/watch?v=9wYssJyvijA">Video</a>   </p>
         <p>Namespaces provide a means for grouping the components of a library
together.</p>
<p>Up to now this has been achieved using the OCaml module system. Since
the components of an OCaml library are modules, a module can be created that
contains all the components of the library as sub-modules. However, there are
some critical problems with creating a single module containing the whole
library:</p>
<ul><li><p>The module is a single unit that has to be linked or not as a whole. This
 means that any program using part of the library must include the entire
 library.</p>
</li><li><p>The module is a choke-point in the dependency graph. If a file depends
 on one thing in the library then it needs to be recompiled if anything
 in the library changes.</p>
</li><li><p>Opening a very large module is slow and can seriously affect build
 performance.</p>
</li></ul>

<p>These problems are caused by the runtime semantics of modules. Namespaces have
no runtime sematics and could provide a solution to these problems.</p>
<p>While the namespaces feature continues to be refined, support for type-level
<em>module aliases</em> was added to the OCaml 4.02 compiler.  This is a trivial
extension of the ML module system that helps to avoid unnecessary code
dependencies, and provides an alternative to strengthening for type equalities.</p>

         <br/></div>
      
         <div style="width:75%">
         <h3 style="border-bottom: thin solid #999999;" id="Higher kinded polymorphism">Higher kinded polymorphism</h3>
         <p><img class="inline" style="float:left; padding-right: 30px" height="40px" src="../mugshots/yallop.jpeg"/>  <span class="complete">Complete</span> by <a href="../people/yallop.html">Jeremy Yallop</a> (Jun 2013 - Aug 2014) <br/><a class="icon-pdf" href="../papers/index.html#higher-2014">Paper</a>   <a class="icon-github" href="https://github.com/ocamllabs/higher">Github</a>   </p>
         <p>Higher-kinded polymorphism (i.e. abstraction over type constructors) is an
essential component of many functional programming techniques such as monads,
folds, and embedded DSLs. ML-family languages typically support a form of
abstraction over type constructors using functors, but the separation between
the core language and the module language leads to awkwardness as functors
proliferate.</p>
<p>The <em>higher</em> library show how to express higher-kinded polymorphism in OCaml
without functors, using an abstract type <code>app</code> to represent type application,
and opaque brands to denote abstractable type constructors. The flexibility of
our approach can be seen by using it to translate a variety of standard
higher-kinded programs into functor-free OCaml code.  Read more about this in
the FLOPS 2014 paper linked above.</p>

         <br/></div>
      
         <div style="width:75%">
         <h3 style="border-bottom: thin solid #999999;" id="Exception matches">Exception matches</h3>
         <p><img class="inline" style="float:left; padding-right: 30px" height="40px" src="../mugshots/yallop.jpeg"/>  <span class="complete">Complete</span> by <a href="../people/yallop.html">Jeremy Yallop</a> (Nov 2013 - Jun 2014) <br/><a class="icon-cloud" href="http://ocamllabs.github.io/compiler-hacking/2014/02/04/handler-case.html">Blog Post</a>   <a href="http://caml.inria.fr/mantis/view.php?id=6318">Bug report</a>   </p>
         <p>OCaml's <code>try</code> construct is good at dealing with exceptions, but not so good at
handling the case where no exception is raised.  This feature (now part of
OCaml 4.02.0) implements a simple extension to <code>try</code> that adds support for
handling the &quot;success&quot; case.</p>
<p>The <code>try</code> construct in current OCaml supports matching against raised
exceptions but not against the value produced when no exception is raised.
Contrariwise, the <code>match</code> construct supports matching against the value
produced when no exception is raised, but does not support matching against
raised exceptions. As implemented, the patch addresses this asymmetry,
extending match with clauses that specify the &quot;failure continuation&quot;:</p>
<pre><code>match expr
with pattern_1 -&gt; expr_1
   | ...
   | pattern_n -&gt; expr_n
   | exception pattern_1' -&gt; expr_1'
   | ...
   | exception pattern_n' -&gt; expr_n'</code></pre>

<p>With this additional extension the choice between <code>match</code> and <code>try</code> becomes
purely stylistic. We might optimise for succinctness, and use try in the case
where exceptions are expected (for example, where they're used for control
flow), reserving match for the case where exceptions are truly exceptional.</p>

         <br/></div>
      
         <div style="width:75%">
         <h3 style="border-bottom: thin solid #999999;" id="Open types">Open types</h3>
         <p><a href="http://lpw25.net"><img class="inline" style="float:left; padding-right: 30px" height="40px" src="../mugshots/lpw25.jpg"/></a>  <span class="complete">Complete</span> by <a href="../people/lpw25.html">Leo White</a> (Oct 2012 - May 2014) <br/><a class="icon-github" href="https://github.com/lpw25/ocaml-open">Github</a>   <a class="icon-cloud" href="http://sites.google.com/site/ocamlopen/">Website</a>   <a href="http://caml.inria.fr/mantis/view.php?id=5584">Bug report</a>   </p>
         <p>Add open extensible types to OCaml. One open type already exists
within OCaml: the <code>exn</code> type used for exceptions. This project extends
this mechanism to allow the programmer to create their own open types.
This has previously been proposed for functional languages a number of
times, for instance as part of a solution to the expression problem
(Loh et al. <a href="http://people.cs.uu.nl/andres/OpenDatatypes.pdf">&quot;Open Data Types and Open Functions&quot;</a>).
Unlike &quot;exn&quot;, these extensible types can have type parameters, allowing
for extensible GADTs.</p>
<p>For example:</p>
<pre class="ocaml"><code class="ocaml">type foo = ..

type foo += A

type foo += B of int

let is_a x =
  match x with
    A -&gt; true
  | _ -&gt; false</code></pre>

<p>This feature was merged upstream into OCaml 4.02 and is now available
as standard.  To try it with OPAM if you have an older system compiler,
just do <code>opam switch 4.02.1</code>.</p>

         <br/></div>
      
         <div style="width:75%">
         <h3 style="border-bottom: thin solid #999999;" id="OCaml Java">OCaml Java</h3>
         <p><a href="http://www.x9c.fr"><img class="inline" style="float:left; padding-right: 30px" height="40px" src="../mugshots/xavierclerc.jpg"/></a>  <span class="complete">Complete</span> by <a href="../people/xclerc.html">Xavier Clerc</a> (Apr 2013 - Aug 2013) <br/><a class="icon-cloud" href="http://ocamljava.x9c.fr/preview/">Homepage</a>   </p>
         <p>OCaml Java is a compiler from OCaml source code to Java bytecode, that can run
on any modern Java runtime. This is an interesting way to explore the multicore
runtime performance of OCaml with a highly concurrent collector, as is present
in the latest JVMs.</p>
<p>The goal of this work is to stabilise and release the <a href="http://ocamljava.x9c.fr/preview/">preview of 2.0</a>,
which greatly improves CPU utilisation and memory footprint.</p>

         <br/></div>
      
         <div style="width:75%">
         <h3 style="border-bottom: thin solid #999999;" id="Syntax extensions">Syntax extensions</h3>
         <p><a href="http://lpw25.net"><img class="inline" style="float:left; padding-right: 30px" height="40px" src="../mugshots/lpw25.jpg"/></a>  <span class="complete">Complete</span> by <a href="../people/lpw25.html">Leo White</a> (Dec 2012 - Jun 2013) <br/><a class="icon-cloud" href="http://lists.ocaml.org/listinfo/wg-camlp4">Working group</a>   <a class="icon-cloud" href="http://www.lpw25.net/2013/01/23/camlp4-alternative-part-1.html">Blog (part 1)</a>   <a class="icon-cloud" href="http://www.lpw25.net/2013/02/05/camlp4-alternative-part-2.html">Blog (part 2)</a>   </p>
         <p>Since its creation camlp4 has proven to be a very useful tool. People
have used it to experiment with new features for OCaml and to provide
interesting meta-programming facilities. However, there is general
agreement that camlp4 is too powerful and complex for the applications
that it is most commonly used for, and there is a growing movement to
provide a simpler alternative.</p>
<p>A working group was formed (wg-camlp4@lists.ocaml.org) regarding the
future of syntax extensions in OCaml. The aim of the working group is
to formulate a solid transition plan to create a 'basic OCaml
ecosystem' that does not require camlp4. Alain Frisch's introductory
email has more detail and can be
<a href="http://lists.ocaml.org/pipermail/wg-camlp4/2013-January/000000.html">found in the archive</a>.</p>

         <br/></div>
      
         <div style="width:75%">
         <h3 style="border-bottom: thin solid #999999;" id="Record disambiguation">Record disambiguation</h3>
         <p><a href="http://lpw25.net"><img class="inline" style="float:left; padding-right: 30px" height="40px" src="../mugshots/lpw25.jpg"/></a>  <span class="complete">Complete</span> by <a href="../people/lpw25.html">Leo White</a> (Sep 2012 - Feb 2013) <br/><a href="http://caml.inria.fr/mantis/view.php?id=5759">Bug report</a>   </p>
         <p>Type-based record disambiguation: <a href="http://www.lpw25.net">Leo</a> helped with the
record-disambiguation branch of OCaml by Jacques Garrigue. This branch uses
type-information to disambiguate between record labels and variant constructors
with the same names. For discussions of the semantics of this feature see
<a href="http://gallium.inria.fr/~scherer/gagallium/resolving-field-names/">Gabriel</a>'s
or
<a href="http://www.lexifi.com/blog/type-based-selection-label-and-constructors">Alain</a>'s
blog posts. Leo rewrote the record-disambiguation branch to use an alternative
semantics and improved the error messages. The branch has since been <a href="https://github.com/ocaml/ocaml/commit/c8273a179cb0bc835924eeca522922a1769d9d54">merged
into OCaml
trunk</a></p>

         <br/></div>
      
  </body>